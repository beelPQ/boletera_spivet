(()=>{let e=async(e,t,n)=>{let o=[];o="GET"==t?{method:"GET"}:{method:"POST",body:n};let r=await fetch(e,o);return await r.json()},t=(e,t,n,o)=>{Swal.fire({icon:`${e}`,title:`${t}`,html:`${n}`,confirmButtonText:`${o}`})},n=()=>{let t=document.querySelector("#curso").value||"",n=new FormData;n.append("idCourse",t),n.append("method","getDocumentIfExist"),e("/admin/includes/modelo/design_diploma/model.php","POST",n).then(e=>{if(e.status){if(e.information){if(sessionStorage.setItem("previousDesign",JSON.stringify(e.information)),"-"!=e.information[0].structure)r(e.information),sessionStorage.setItem("designPreviewFinished","true");else{sessionStorage.setItem("designPreviewFinished","false"),document.querySelector(".content-desig-gen");let t=document.querySelector(".content-controls"),n=document.createElement("div");n.id="alertNewDesign",n.classList.add("alert","alert-success","mt-5"),n.style.display="flex",n.style.flexDirection="column",n.innerHTML=`<h4 class="alert-heading">\xa1Bienvenido al dise\xf1ador de diploma!</h4>
                                  <p>Para poder iniciar es necesario presionar el bot\xf3n <strong>"Configurar documento"</strong> que se encuentra en la parte inferior de opciones</p>
                                  <p>Selecciona una orientaci\xf3n y adjunta la imegen de fondo</p>`,t.insertAdjacentElement("beforebegin",n);let a=document.querySelector(".content-sections");a.style.display="none",o("disabled")}setTimeout(()=>{let e=document.querySelectorAll(".anim-skeleton");e.forEach(e=>{e.classList.remove("skeleton")})},2e3)}else{sessionStorage.setItem("previousDesign","[]"),sessionStorage.setItem("designPreviewFinished","false"),document.querySelector(".content-desig-gen");let i=document.querySelector(".content-controls"),l=document.createElement("div");l.id="alertNewDesign",l.classList.add("alert","alert-success","mt-5"),l.style.display="flex",l.style.flexDirection="column",l.innerHTML=`<h4 class="alert-heading">\xa1Bienvenido al dise\xf1ador de diploma!</h4>
                             <p>Para poder iniciar es necesario presionar el bot\xf3n <strong>"Configurar documento"</strong> que se encuentra en la parte inferior de opciones</p>
                            <p>Selecciona una orientaci\xf3n y adjunta la imegen de fondo</p>`,i.insertAdjacentElement("beforebegin",l);let s=document.querySelector(".content-sections");s.style.display="none",o("disabled"),setTimeout(()=>{let e=document.querySelectorAll(".anim-skeleton");e.forEach(e=>{e.classList.remove("skeleton")})},2e3)}}}).catch(e=>{console.error(e)})},o=(e="disabled")=>{"active"==e?(document.querySelector("#btnPrint").disabled=!1,document.querySelector("#btnSaveStructureDocto").disabled=!1,document.querySelector("#btnCancelDesign").disabled=!1):(document.querySelector("#btnPrint").disabled=!0,document.querySelector("#btnSaveStructureDocto").disabled=!0,document.querySelector("#btnCancelDesign").disabled=!0)},r=e=>{let t=e[0],n=document.querySelector("#contentGeneral");"portrait"==t.orientation?n.classList.add("gen-portrait"):n.classList.add("gen-landscape"),n.innerHTML=t.structure;let o=document.querySelector("#contentDiploma");o.classList.add("skeleton");let r=o.childNodes;document.querySelector(".content-columns-control"),r.forEach(e=>{if("tagtogNameUser"==e.id||"tagtogCredits"==e.id){let t=e.id.split("tag")[1];document.querySelector(`#${t}`).checked=!0;let n=document.querySelector(`#con${e.id}`),o=n.querySelector(`#${e.id}`);n.removeChild(o),a(e.id,e.dataset.x,e.dataset.y)}});let i=document.querySelector("#desicionOrientation");if("portrait"==t.orientation){let l=i.querySelector("#orientationPortrait");l.classList.add("btn-selected")}else if("landscape"==t.orientation){let s=i.querySelector("#orientationLandscape");s.classList.add("btn-selected")}let c=document.querySelector("#selectTypography");c.value=t.fontFamily;let d=document.querySelector(".content-sections-mockup"),u=document.createElement("button");u.id="btnDeleteDesign",u.classList.add("btn","btn-delete-design","anim-skeleton","skeleton"),d.appendChild(u)},a=(e,t="",n="")=>{if(""!=t&&""!=n){let o={x:parseFloat(t),y:parseFloat(n)};interact(`#${e}`).draggable({listeners:{start(e){},move(e){o.x+=e.dx,o.y+=e.dy,e.target.style.transform=`translate(${o.x}px, ${o.y}px)`,e.target.setAttribute("data-x",o.x),e.target.setAttribute("data-y",o.y)}}})}else interact(`#${e}`).draggable({onmove:function(e){let o=e.target,r="",a="";""!=t&&""!=n?(r=(parseFloat(t)||0)+e.dx,a=(parseFloat(n)||0)+e.dy):(r=(parseFloat(o.getAttribute("data-x"))||0)+e.dx,a=(parseFloat(o.getAttribute("data-y"))||0)+e.dy),o.style.transform="translate("+r+"px, "+a+"px)",o.setAttribute("data-x",r),o.setAttribute("data-y",a)}})},i=()=>{let n=new FormData;n.append("method","getFontsDesign"),e("/admin/includes/modelo/design_diploma/model.php","POST",n).then(e=>{if(e.status){let n="",o=document.querySelector("#selectTypography");sessionStorage.setItem("fonts",JSON.stringify(e.data));let r=document.createElement("option");r.value="",r.innerText="Seleccionar",r.disabled=!0,r.selected=!0,o.appendChild(r),e.data.forEach(e=>{let t=document.createElement("option");t.value=`${e.numFont}|${e.nameFont}`,t.innerText=`${e.nameFont}`,o.appendChild(t),n+=`${e.linkFont}`});let a=document.querySelector("head"),i=document.createElement("style"),l=n;i.innerText=l,a.appendChild(i)}else t("error","Fuentes no encontradas",e.message,"Entendido")}).catch(e=>{console.error(e)})},l=()=>{document.querySelector("#contentSpinnerPrimary").style.display="flex";let n=document.querySelector("#curso").value||"",o=document.getElementById("contentGeneral"),r=document.getElementById("credits"),a=r.value,i=`<input id="credits" class="form-control-custom" type="text" value="${a}" maxlength="48">`,l=o.innerHTML.replace(/&quot;/g,"");l=l.includes('<input class="form-control-custom" type="text" id="credits" value="" maxlength="48">')?l.replace('<input class="form-control-custom" type="text" id="credits" value="" maxlength="48">',i):l.replace('<input id="credits" type="text" class="form-control-custom" value="" maxlength="48">',i);let s="landscape";if(sessionStorage.getItem("configOrientation")){let c=JSON.parse(sessionStorage.getItem("configOrientation"));s=c.orientation}let d="",u=document.querySelector("#selectTypography").value||"";d=""!=u?u.split("|")[1]:"Ubuntu";let m=new FormData;m.append("structure",l),m.append("idCourse",n),m.append("orientation",s),m.append("fontFamily",d),m.append("method","previewDesignDocument"),e("/admin/includes/modelo/design_diploma/model.php","POST",m).then(e=>{e.status?(window.open(`/admin/files/mockups/certificado/${e.nameDocto}`,"_blank"),document.querySelector("#contentSpinnerPrimary").style.display="none"):(document.querySelector("#contentSpinnerPrimary").style.display="none",t("warning","Ha ocurrido un error",e.message,"Entendido"))}).catch(e=>{document.querySelector("#contentSpinnerPrimary").style.display="none",console.error(e)})},s=()=>{document.querySelector("#contentSpinnerPrimary").style.display="flex";let n=document.querySelector("#curso").value||"",o=document.getElementById("contentGeneral"),r=document.getElementById("credits"),a=r.value,i=`<input id="credits" class="form-control-custom" type="text" value="${a}" maxlength="48">`,l=o.innerHTML.replace(/&quot;/g,"");l=l.includes('<input class="form-control-custom" type="text" id="credits" value="" maxlength="48">')?l.replace('<input class="form-control-custom" type="text" id="credits" value="" maxlength="48">',i):l.replace('<input id="credits" type="text" class="form-control-custom" value="" maxlength="48">',i);let s="landscape";if(sessionStorage.getItem("configOrientation")){let c=JSON.parse(sessionStorage.getItem("configOrientation"));s=c.orientation}let d="",u=document.querySelector("#selectTypography").value||"";d=""!=u?u:"Ubuntu";let m=new FormData;m.append("structure",l),m.append("idCourse",n),m.append("orientation",s),m.append("fontFamily",d),m.append("method","saveDesignDocument"),e("/admin/includes/modelo/design_diploma/model.php","POST",m).then(e=>{e.status?(document.querySelector("#contentSpinnerPrimary").style.display="none",t("success",`Dise\xf1o almacenado`,`El dise\xf1o ha sido <strong> almacenado </strong> exitosamente`,"Entendido")):(document.querySelector("#contentSpinnerPrimary").style.display="none",t("warning","Ha ocurrido un error",e.message,"Entendido"))}).catch(e=>{t("warning","Ha ocurrido un error",e,"Entendido"),document.querySelector("#contentSpinnerPrimary").style.display="none",console.error(e)})},c=(n,r)=>{let a=document.querySelector("#curso").value||"";document.getElementById("contentGeneral").innerHTML;let i=new FormData;i.append("idCourse",a),i.append("imagen",r),i.append("orientation",n),i.append("method","saveOrientationBackground"),e("/admin/includes/modelo/design_diploma/model.php","POST",i).then(e=>{if(e.status){document.querySelector("#btnCloseModalConfig").click();let n=document.querySelector("#contentDiploma"),r=new Date().getTime();n.style.backgroundImage=`url('/admin/images/design_diploma/${e.nameImage}?v=${r}')`;let a=document.querySelector(".content-desig-gen"),i=document.querySelector("#alertNewDesign");a.removeChild(i),document.querySelector(".content-sections").style.display="flex",o("active")}else t("error",e.title,e.message,"Entendido")}).catch(e=>{console.error(e)})},d=e=>{let t=document.querySelector("#contentDiploma"),n=document.querySelector("#contentGeneral");"landscape"==e?(t.classList.add("orien-landscape"),t.classList.remove("orien-portrait"),n.classList.add("gen-landscape"),n.classList.remove("gen-portrait")):"portrait"==e&&(t.classList.add("orien-portrait"),t.classList.remove("orien-landscape"),n.classList.add("gen-portrait"),n.classList.remove("gen-landscape"))},u=e=>{let t=document.querySelector(`#con${e}`),n=document.createElement("div");if(n.classList.add("element-tag","tag-disabled"),n.id=e,"tagtogNameUser"==e)n.classList.add("tag-name"),n.innerText="Nombre completo del participante";else if("tagtogCredits"==e){let o=document.createElement("input");o.classList.add("form-control-custom"),o.type="text",o.id="credits",o.setAttribute("value",""),o.setAttribute("maxlength","48"),n.classList.add("tag-credit"),n.appendChild(o)}t.appendChild(n)},m=(e,t)=>{let n=document.querySelector("#curso").value||"",o={};o.course=n,"orientationPortrait"==e&&(o.orientation="portrait"),"orientationLandscape"==e&&(o.orientation="landscape"),sessionStorage.setItem("configOrientation",JSON.stringify(o)),d(o.orientation),c(o.orientation,t.files[0])},p=()=>{let n=document.querySelector("#curso").value||"",o=new FormData;o.append("idCourse",n),o.append("method","deleteDesign"),e("/admin/includes/modelo/design_diploma/model.php","POST",o).then(e=>{e.status?Swal.fire({title:"Dise\xf1o eliminado",html:`El dise\xf1o ha sido <strong> eliminado </strong> exitosamente </br>  <strong> \xbfDeseas realizar un nuevo dise\xf1o \xf3 ir a la lista de cursos? </strong>`,icon:"success",showCancelButton:!0,confirmButtonText:"Seguir en el dise\xf1ador",cancelButtonText:"Ir a cursos"}).then(e=>{e.isConfirmed?window.location.reload():window.location.href="/admin/index.php?id=lista-cursos-design"}):t("error","Error",e.message,"Entendido")}).catch(e=>{console.error(e)})},g=e=>{if(""!=e){let n=document.querySelectorAll(".element-tag");n.forEach(t=>{t.style.fontFamily=e})}else t("warning","Cuidado","Favor de seleccionar una fuente para las etiquetas")},y=document.querySelector("#btnPrint");y.addEventListener("click",l),window.addEventListener("click",e=>{let n=e.target.id;if("orientationPortrait"==n){let o=document.querySelector(`#${n}`);if(o.classList.contains("btn-selected"))o.classList.remove("btn-selected");else{o.classList.add("btn-selected");let r=document.querySelector("#orientationLandscape");r.classList.remove("btn-selected")}}if("orientationLandscape"==n){let a=document.querySelector(`#${n}`);if(a.classList.contains("btn-selected"))a.classList.remove("btn-selected");else{a.classList.add("btn-selected");let i=document.querySelector("#orientationPortrait");i.classList.remove("btn-selected")}}if("addBackgDocument"==n){let l=document.querySelector(`#${n}`),c=document.querySelector("#imageDocto");c.click(),c.addEventListener("change",function(e){let t=e.target.files[0];t&&(console.log(t),l.innerText=t.name)})}if("btnSaveOrientationBack"==n){let d=document.querySelector("#desicionOrientation"),u=d.querySelector(".btn-selected"),g=document.querySelector("#imageDocto");u?g.files.length>0?m(u.id,g):t("warning",`Informaci\xf3n incompleta`,`Favor de proporcionar una <strong> imagen de fondo </strong> para el dise\xf1o`,"Entendido"):t("warning",`Informaci\xf3n incompleta`,`Favor de seleccionar una <strong> orientaci\xf3n </strong> para el dise\xf1o`,"Entendido")}if("btnSaveStructureDocto"==n){let y=document.querySelector("#selectTypography");""!=y.value?Swal.fire({title:"Guardar",text:"\xbfSeguro que deseas guardar el dise\xf1o previamente echo?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#000",confirmButtonText:"Si guardar"}).then(e=>{e.isConfirmed&&s()}):t("warning","Sin fuente seleccionada",`Favor de seleccionar una <strong> fuente </strong> para el dise\xf1o`,"Entendido")}"openConfigDocument"==n&&sessionStorage.getItem("designPreviewFinished")&&"true"==sessionStorage.getItem("designPreviewFinished")&&Swal.fire({title:"Cuidado, cambio de configuraci\xf3n",html:`Si usted desea hacer una cambio sobre la configuraci\xf3n del documento <strong> ser\xe1 necesario seleccionar orientaci\xf3n y adjuntar imagen </strong></br> \xbfRealmente desea continuar con la acci\xf3n?`,icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#000",confirmButtonText:"Si continuar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed||document.querySelector("#btnCloseModalConfig").click()}),"btnCancelDesign"==n&&(sessionStorage.getItem("designPreviewFinished")&&"true"==sessionStorage.getItem("designPreviewFinished")?Swal.fire({title:"Cancelar",html:`<strong>\xbfSeguro que deseas cancelar?</strong></br></br>Todos los cambios no guardados despu\xe9s del \xfaltimo guardado se perder\xe1n`,icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#000",confirmButtonText:"Si cancelar",cancelButtonText:"No cancelar"}).then(e=>{e.isConfirmed&&(window.location.href="/admin/index.php?id=lista-cursos-design")}):Swal.fire({title:"Cancelar",html:`<strong>\xbfSeguro que deseas cancelar?</strong></br></br>Todos los cambios no guardados se perder\xe1n`,icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#000",confirmButtonText:"Si cancelar",cancelButtonText:"No cancelar"}).then(e=>{e.isConfirmed&&(window.location.href="/admin/index.php?id=lista-cursos-design")})),"btnDeleteDesign"==n&&Swal.fire({title:"Eliminar",html:`<strong>\xbfSeguro que deseas eliminar el dise\xf1o guardado?</strong></br></br>Todos los cambios se perder\xe1n`,icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Si eliminar",cancelButtonText:"cancelar"}).then(e=>{e.isConfirmed&&p()})}),window.addEventListener("dragstart",e=>{let t=e.target.id;("tagtogNameUser"==t||"tagtogCredits"==t)&&(console.log(t),e.dataTransfer.setData("text/plain",t))});let f=()=>{let e=document.querySelector(".content-diploma");e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",t=>{t.preventDefault();let n=t.dataTransfer.getData("text/plain"),o=document.getElementById(n);e.append(o),a(n,"","")})};window.addEventListener("change",e=>{let t=e.target.id;if("togNameUser"==t||"togCredits"==t){let n=document.querySelector(`#${t}`),o=document.querySelector(`#tag${t}`);if(n.checked)o.classList.remove("tag-disabled"),o.draggable="true";else{let r=document.querySelector("#contentDiploma");r.contains(o)?(interact(`#tag${t}`).unset(),r.removeChild(o),u(`tag${t}`)):(o.classList.add("tag-disabled"),o.draggable="false")}}if("selectTypography"==t){let a=document.getElementById(t),i=a.value.split("|")[1];g(i)}}),window.addEventListener("DOMContentLoaded",()=>{i();let e=document.querySelector(".content-columns-control"),t=e.querySelectorAll("input");t.forEach(e=>{e.checked=!1}),n(),document.querySelector("#collapseMenu")&&document.querySelector("#collapseMenu").click(),setTimeout(()=>{f()},600)})})();