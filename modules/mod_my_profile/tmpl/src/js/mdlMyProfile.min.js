(()=>{"use strict";let e=null,t=null,l=null,r=null,a=null,o=null,n=null,i=null,c=null,s=null,u="/modules/mod_buycarform/tmpl/assets/plugin/img/logo_subir_imagen.png",d="",p=null,m=new FormData,y,f=async(e,t,l)=>{let r=[];r="GET"==t?{method:"GET"}:{method:"POST",body:l};let a=await fetch(e,r);return await a.json()},g=()=>{let t=e.querySelector("#telwhat");window.intlTelInput(t,{preferredCountries:["mx","us"],utilsScript:"/modules/mod_buycarform/tmpl/assets/plugin/js/utils.js"})},$=()=>{let t=new FormData;t.append("method","getCountries"),f("/modules/mod_buycarform/tmpl/model/buyCarForm.php","POST",t).then(t=>{if(t.status){let l="";l+='<option value="no_selected" disabled selected>Seleccionar</option>',t.data.forEach(e=>{l+=`<option value="${e.id}">${e.country}</option>`}),e.querySelector("#country").innerHTML=l}}).catch(e=>{console.error(e),Swal.fire({title:"Error al cargar los paises",text:"No se pudo optener la informaci\xf3n completa de los paises",icon:"warning",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})})},h=(e=0,t=0)=>{let l=new FormData;0!=e?(l.append("method","getStatesForCountry"),l.append("idCountry",e)):l.append("method","getStates"),f("/modules/mod_buycarform/tmpl/model/buyCarForm.php","POST",l).then(e=>{if(e.status){let l="";l+='<option value="no_selected" disabled selected>Seleccionar</option>',e.data.forEach(e=>{l+=`<option value="${e.id}" ${t>0&&t==e.id?"selected":""} >${e.state}</option>`}),document.querySelector("#state").innerHTML=l}}).catch(e=>{console.error(e),Swal.fire({title:"Error al cargar los estados",text:"No se pudo optener la informaci\xf3n completa de los estados",icon:"warning",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})})},v=e=>{let t=e.charCode;return t>=48&&t<=57},b=()=>{y=new Cropper(i,{aspectRatio:1,viewMode:1,dragMode:"move",responsive:!0,movable:!0,zoomable:!0,scalable:!0,zoomOnWheel:!0,minContainerWidth:200,minContainerHeight:200,minCanvasWidth:20,minCanvasHeight:20})},S=()=>{null!==y&&y.destroy(),y=null,i.src=u},C=()=>{let e,t;y&&(t=y.getCroppedCanvas({width:260,height:260}),l.removeAttribute("style"),e=a.src,a.src=t.toDataURL(),t.toBlob(function(e){})),S(),o.style.display="block",a.classList.remove("changeimg")},w=function(e){r.value="",i.src=e,n.click()},q=e=>{let t=e.files;if(t&&t.length>0){let l=t[0],r=URL.createObjectURL(l)??"";null!==i&&("object"==typeof y&&S(),""!==r?w(URL.createObjectURL(l)):FileReader&&((reader=new FileReader).onload=function(e){w(reader.result)},reader.readAsDataURL(l)),setTimeout(()=>b(),250))}},E=()=>{l.style.display="none",a.src.includes("data:image")?a.src=""!=d.trim()?d:u:a.src=u,a.classList.add("changeimg"),o.style.display="none"},L=e=>{null===e||e.src.includes("data:image")||r.click()},A=()=>{let t=0,l=e.querySelectorAll("input"),r=e.querySelectorAll("select");return l.forEach(e=>{let t=e.id,l=e.value;if(e.classList.remove("is-invalid"),""!=l.trim()){if("telwhat"==t){let r=e.closest(".iti"),a=r.querySelector(".iti__selected-flag")||null;if(null!==a){let o=a.getAttribute("title").split(":")[1].trim();m.append("lada",`${o.replaceAll(" ","")}`)}else m.append("lada","+52");m.append("phoneNumber",`${l.replaceAll(" ","")}`)}else"cp"==t?m.append("postlaCode",l):m.append(`${t}`,l)}else e.classList.add("is-invalid")}),r.forEach(e=>{let t=e.id,l=e.value;e.classList.remove("is-invalid"),"no_selected"!=l.trim()?m.append(`${t}`,parseInt(l)):e.classList.add("is-invalid")}),a.classList.remove("invalid"),a.src.includes(u)?(a.classList.add("invalid"),t+=1):m.append(`${a.id}`,a.src),t},_=()=>{m.append("method","updateProfile"),m.append("userid",localStorage.getItem("userid")||""),m.append("tmiduser",document.body.getAttribute("data-id")||0),m.append("tmemailuser",document.body.getAttribute("data-email")||""),f("/modules/mod_my_profile/tmpl/controllers/mdlMyProfile.php","POST",m).then(e=>{let{result:t,message:l,id_client:r}=e,a=""!=l.trim()?l:"Datos actualizados correctamenete";Swal.fire({title:a,icon:t,confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})}).catch(e=>{console.log(e),Swal.fire({title:"Error inespera",text:e,icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})})},k=(r,a)=>{let n=new FormData;n.append("method","get_user_auth"),n.append("id",localStorage.getItem("userid")||""),n.append("name",r),n.append("email",a),f("/modules/mod_buycarform/tmpl/model/buyCarForm.php","POST",n).then(n=>{let{status:i,message:c,description:s,data:u}=n;if(!i){Swal.fire({title:c,text:s,icon:"warning",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1});return}let p="",m="",y="",f="",g="",$="",v="",b="";if(0==u.length){let S=r.split(" ");S.length>0&&(p=`${S[0]}`,m="",y="",2==S.length&&(p=`${S[0]}`,m=`${S[1]}`),3==S.length&&(p=`${S[0]}`,m=`${S[1]}`,y=`${S[2]}`),S.length>3&&(p=`${S[0]} ${S[1]}`,m=`${S[2]}`,y=`${S[3]}`))}else p=u.name??"",m=u.surname??"",y=u.secsurname??"",a=u.email??"",f=u.phone??"",g=0==parseInt(u.cPostal)?"":u.cPostal,$=0==parseInt(u.countryId)?"":u.countryId,v=0==parseInt(u.stateId)?"":u.stateId,b="-"==(b=u.photo??"")||"--"==b?"":b;let C=e.querySelector("#name");""!=p.trim()&&(C.value=p);let w=e.querySelector("#lastname1");""!=m.trim()&&(w.value=m);let q=e.querySelector("#lastname2");""!=y.trim()&&(q.value=y);let E=e.querySelector("#email");""!=a.trim()&&(E.value=a);let L=e.querySelector("#telwhat");""!=f.trim()&&(L.value=f.replaceAll(" ",""));let A=e.querySelector("#cp");""!=g.trim()&&(A.value=g);let _=e.querySelector("#country");""!=$.trim()&&setTimeout(()=>{let e=_.querySelectorAll("option");e.forEach(e=>{e.value==$&&(e.setAttribute("selected","selected"),""!=v.trim()&&h($,v))})},500);let k=t.querySelector("#avatar");""!=b.trim()&&(d=`/images/clientes/fotos/${b}`,k.src=d,l.removeAttribute("style"),o.removeAttribute("style"))}).catch(e=>{console.error(e),Swal.fire({title:"Error al cargar la informaci\xf3n del usuario",text:"Vuelva a recargar la p\xe1gina",icon:"warning",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})})};document.addEventListener("DOMContentLoaded",()=>{t=document.querySelector(".my_profile-left"),e=document.querySelector("#formDataProfile"),l=t.querySelector(".content_preview_image"),r=t.querySelector("#inputCropFile"),a=t.querySelector("img#avatar")||null,o=t.querySelector("#btnDeleteImg")||null,p=document.querySelector("#btnActionsContent");let u=document.body.getAttribute("data-name")||"",d=document.body.getAttribute("data-email")||"";n=document.getElementById("btnModalCrop")||null,i=document.querySelector("#imageCropper")||null,c=document.querySelector("#btnSaveCropProfile")||null,s=document.querySelector("#closeCropProfile")||null,g(),$();let m=e.querySelector("#country");m.addEventListener("change",e=>{""!==m.value&&h(m.value)}),null!==e.querySelector("#telwhat")&&e.querySelector("#telwhat").addEventListener("keypress",e=>{v(e)||e.preventDefault()}),k(u,d),null!==r&&r.addEventListener("change",e=>{q(r)}),null!==a&&a.addEventListener("click",e=>{e.preventDefault(),o.style.display="block",a.classList.contains("changeimg")&&L(a)}),null!==o&&o.addEventListener("click",E),null!==c&&c.addEventListener("click",C),null!==s&&s.addEventListener("click",S)}),window.addEventListener("load",()=>{null!==p&&p.addEventListener("click",()=>{0==A()?_():Swal.fire({title:"Verifique sus datos",text:"",icon:"info",confirmButtonText:"Aceptar",confirmButtonColor:"#000",allowOutsideClick:!1,allowEscapeKey:!1})})})})();